version: 2

{% if instance.config_drive.network_config.ethernets is defined %}

ethernets:

{% for ethernet in instance.config_drive.network_config.ethernets %}

  {{ ethernet.name }}:

{% if ethernet.mtu is defined %}
     mtu: {{ ethernet.mtu }}
{% endif %}

{% if ethernet.addresses is defined %}
     addresses: [ {{ ethernet.addresses | join(", ") }} ]
{% endif %}

{% if ethernet.gateway4 is defined %}
     gateway4: {{ ethernet.gateway4 }}
{% endif %}

{% if ethernet.nameservers is defined %}
     nameservers:
         search: [ {{ ethernet.nameservers.search | join(", ") }} ]
         addresses: [ {{ ethernet.nameservers.addresses | join(", ") }} ]
{% endif %}

{% if ethernet.routes is defined %}
     routes:
{% for routing in ethernet.routes %}
     - to: {{ routing.to }}
       via: {{ routing.via }}
{% endfor %}

{% endif %}

{% endfor %}

{% endif %}


{% if instance.config_drive.network_config.vlans is defined %}

vlans:

{% for vlan in instance.config_drive.network_config.vlans %}

  {{ vlan.name }}:

     id: {{ vlan.id }}
     link: {{ vlan.link }}

{% if vlan.mtu is defined %}
     mtu: {{ vlan.mtu }}
{% endif %}

{% if vlan.addresses is defined %}
     addresses: [ {{ vlan.addresses | join(", ") }} ]
{% endif %}

{% if vlan.gateway4 is defined %}
     gateway4: {{ vlan.gateway4 }}
{% endif %}

{% if vlan.nameservers is defined %}
     nameservers:
         search: [ {{ vlan.nameservers.search | join(", ") }} ]
         addresses: [ {{ vlan.nameservers.addresses | join(", ") }} ]
{% endif %}

{% if vlan.routes is defined %}
     routes:
{% for routing in vlan.routes %}
     - to: {{ routing.to }}
       via: {{ routing.via }}
{% endfor %}

{% endif %}

{% endfor %}

{% endif %}


{% if instance.config_drive.network_config.wifis is defined %}

wifis:

{% for wifi in instance.config_drive.network_config.wifis %}

  {{ wifi.name }}:

{% if wifi.mtu is defined %}
     mtu: {{ wifi.mtu }}
{% endif %}

{% if wifi.addresses is defined %}
     addresses: [ {{ wifi.addresses | join(", ") }} ]
{% endif %}

{% if wifi.gateway4 is defined %}
     gateway4: {{ wifi.gateway4 }}
{% endif %}

{% if wifi.nameservers is defined %}
     nameservers:
         search: [ {{ wifi.nameservers.search | join(", ") }} ]
         addresses: [ {{ wifi.nameservers.addresses | join(", ") }} ]
{% endif %}

{% if wifi.routes is defined %}
     routes:
{% for routing in wifi.routes %}
     - to: {{ routing.to }}
       via: {{ routing.via }}
{% endfor %}

{% endif %}

{% endfor %}

{% endif %}


{% if instance.config_drive.network_config.bonds is defined %}

bonds:

{% for bond in instance.config_drive.network_config.bonds %}

  {{ bond.name }}:

{% if bond.mtu is defined %}
     mtu: {{ bond.mtu }}
{% endif %}

{% if bond.addresses is defined %}
     addresses: [ {{ bond.addresses | join(", ") }} ]
{% endif %}

{% if bond.gateway4 is defined %}
     gateway4: {{ bond.gateway4 }}
{% endif %}

{% if bond.nameservers is defined %}
     nameservers:
         search: [ {{ bond.nameservers.search | join(", ") }} ]
         addresses: [ {{ bond.nameservers.addresses | join(", ") }} ]
{% endif %}

{% if bond.routes is defined %}
     routes:
{% for routing in bond.routes %}
     - to: {{ routing.to }}
       via: {{ routing.via }}
{% endfor %}

{% endif %}

{% endfor %}

{% endif %}


{% if instance.config_drive.network_config.bridges is defined %}

bridges:

{% for bridge in instance.config_drive.network_config.bridges %}

  {{ bridge.name }}:

{% if bridge.mtu is defined %}
     mtu: {{ bridge.mtu }}
{% endif %}

{% if bridge.addresses is defined %}
     addresses: [ {{ bridge.addresses | join(", ") }} ]
{% endif %}

{% if bridge.gateway4 is defined %}
     gateway4: {{ bridge.gateway4 }}
{% endif %}

{% if bridge.nameservers is defined %}
     nameservers:
         search: [ {{ bridge.nameservers.search | join(", ") }} ]
         addresses: [ {{ bridge.nameservers.addresses | join(", ") }} ]
{% endif %}

{% if bridge.routes is defined %}
     routes:
{% for routing in bridge.routes %}
     - to: {{ routing.to }}
       via: {{ routing.via }}
{% endfor %}

{% endif %}

{% endfor %}

{% endif %}
